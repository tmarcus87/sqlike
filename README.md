SQLike
=======

SQLike is a O/R mapper with SQL-like syntax for Golang, inspired by [jOOQ](https://www.jooq.org/) 

## Install

```
$ go get -u github.com/tmarcus87/sqlike
```

## Requirements

* Golang 1.13+

## SchemeGenerator
 
You can generate model & schema definition from database by using `sqlikegen`.

### Install

```
$ go install github.com/tmarcus87/sqlike/sqlikegen

$ sqlikegen -help
Usage of sqlikegen
  -d string
        Database for generating code
  -h string
        Host&Port for connecting to database format : 'host:port'
  -help
        Show usage
  -o string
        Output dir
  -p string
        Password for connecting to database
  -pkg string
        Output package
  -t string
        Database type for generating code
  -u string
        Username for connecting to database

# Generate example
$ sqlikegen -t mysql -d library -u user -p password -h localhost:3306 -o library
```


## Example

```go
package main

import (
    _ "github.com/go-sql-driver/mysql"
    "github.com/tmarcus87/sqlike"
    "github.com/tmarcus87/sqlike_example/model/sampledb"    // Generated by sqlikegen
)

type Book struct {
    Id       int64  `sqlike:"id"`
    Name     string `sqlike:"title"`
    AuthorId int64  `sqlike:"author_id"`
}

func main() {
    engine, err :=
        sqlike.NewEngine(
            sqlike.FromHostAndPort("mysql", "master.example.com", 3306, "user", "password", "database"),
            sqlike.WithSlaveByHostAndPort("slave.example.com", 13306, "user", "password"))
    if err != nil {
        panic(err)
    }

    books := make([]*Book, 0)

    // Insert & fetch last insert id
    authorId, err :=
        engine.
            NewSession(context.Background()).
            InsertInto(sampledb.Author()).
            Columns(sampledb.Author().Name()).
            Values("William Shakespeare").
            Build().Execute().LastInsertId();
    if err != nil {
        panic(err)
    }

    // Insert w/ columns & values
    if err :=
        engine.
            NewSession(context.Background()).
            InsertInto(sampledb.Book()).
            Columns(sampledb.Book().Name(), sampledb.Book().AuthorId()).
            Values("Hamlet", authorId).
            Build().Execute().Error(); err != nil {
        panic(err)
    }

    // Insert w/ struct record
    if err :=
        engine.
            NewSession(context.Background()).
            InsertInto(sampledb.Book()).
            Record(sqlike.RecordWithSkip(
                &Book{
                    Name:     "King Lear",
                    AuthorId: authorId,
                },
                sampledb.Book().Id()).
            Build().Execute().Error(); err != nil {
        panic(err)
    }

    // Query
    if err :=
        engine.
            NewSession(context.Background()).
            Select(
                sampledb.Book().Id(),
                sampledb.Book().Name().As("title")).
            From(sampledb.Author()).
            InnerJoin(sampledb.Book(), sampledb.Book().AuthorId().EqCol(sampledb.Author().Id())).
            Where(sampledb.Author().Name().Eq("William Shakespeare")).
            OrderBy(sampledb.Book().Name().Asc())
            LimitAndOffset(5, 0).
            Build().
            FetchInto(&books); err != nil {
        panic(err)
    }

    for i, book := range books {
        fmt.Printf("%4d %s", book.Id, book.Name)
    }
}
```

More examples can be found in 'examples'.

